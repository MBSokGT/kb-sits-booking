# üìã –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –±–∞–≥–æ–≤ - –ö–ë –°–∏—Ç—Å

**–î–∞—Ç–∞**: 26.02.2026  
**–°—Ç–∞—Ç—É—Å**: –ß–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ ‚ö†Ô∏è

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

### 1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å localStorage** [app.js L1-25]
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ `DB.get()` –∏ `DB.set()`
- ‚úÖ –¢–µ–ø–µ—Ä—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ù–ï –ø–∞–¥–∞–µ—Ç –≤ private —Ä–µ–∂–∏–º–µ –±—Ä–∞—É–∑–µ—Ä–∞
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏—Ç alert –µ—Å–ª–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–æ

```javascript
// –î–û: try/catch –±–µ–∑ –≤—ã–≤–æ–¥–∞ –æ—à–∏–±–∫–∏
// –ü–û–°–õ–ï: –í—ã–≤–æ–¥–∏—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

### 2. **Null checks –Ω–∞ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏** [app.js L40-60]
- ‚úÖ `getCoworkings()`, `getUsers()`, `getFloors()`, `getSpaces()`, `getBookings()` —Ç–µ–ø–µ—Ä—å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –º–∞—Å—Å–∏–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ `Array.isArray()` –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
- ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –æ—à–∏–±–∫–∞ "undefined is not iterable"

### 3. **–û—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏ logout** [app.js L263-280]
- ‚úÖ `doLogout()` —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
  - `selCoworkingId = null`
  - `selFloorId = null`
  - `selDates = []`
  - `editorSpaces = []`
  - –∏ –¥—Ä—É–≥–∏–µ

### 4. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏** [app.js L614-625]
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (30 –º–∏–Ω—É—Ç)
- ‚úÖ –ë–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### 5. **XSS –∑–∞—â–∏—Ç–∞ - —Ñ—É–Ω–∫—Ü–∏–∏ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è** [app.js –Ω–∞—á–∞–ª–æ]
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã 2 —Ñ—É–Ω–∫—Ü–∏–∏:
  - `escapeHtml(text)` - –¥–ª—è HTML
  - `escapeCSV(value)` - –¥–ª—è CSV (–∑–∞—â–∏—Ç–∞ –æ—Ç —Ñ–æ—Ä–º—É–ª Excel)

### 6. **–ß–∞—Å—Ç–∏—á–Ω–∞—è XSS –∑–∞—â–∏—Ç–∞ –≤ UI** [app.js —Ä–∞–∑–ª–∏—á–Ω—ã–µ –º–µ—Å—Ç–∞]
- ‚úÖ renderMapView - —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω `bk.userName` –≤ SVG
- ‚úÖ renderMiniBookings - —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω `sp.label`  
- ‚úÖ renderListView - —ç–∫—Ä–∞–Ω–∏—Ä–µ–Ω—ã `sp.label` –∏ `bk.userName`
- ‚ö†Ô∏è –ê–¥–º–∏–Ω-—Ç–∞–±–ª–∏—Ü—ã - —Ç—Ä–µ–±—É—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã

---

## ‚è≥ –¢–†–ï–ë–£–ï–¢ –î–û–†–ê–ë–û–¢–ö–ò

### 1. **Async/await –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ** [–í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢] üî¥
- –ü—Ä–æ–±–ª–µ–º–∞: `getFloorsByCoworking()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –±–µ–∑ `await`
- –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è: Race condition –ø—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏, —Å–ª—É—á–∞–π–Ω—ã–µ undefined –æ—à–∏–±–∫–∏
- **–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤—Å–µ –Ω–∞ sync –∏–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞ async

```javascript
// –î–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
const floors = getFloorsByCoworking(selCoworkingId);
if (!floors.some(...)) // –º–æ–∂–µ—Ç –±—ã—Ç—å undefined!

// –ù–£–ñ–ù–û –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –Ω–∞ sync –≤–∞—Ä–∏–∞–Ω—Ç
```

### 2. **–ó–∞—â–∏—Ç–∞ –æ—Ç XSS –ù–ï –ü–û–õ–ù–ê–Ø** [–í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢] üî¥
–û—Å—Ç–∞—Ç–æ–∫ –º–µ—Å—Ç –≥–¥–µ –Ω—É–∂–Ω–∞ –∑–∞—â–∏—Ç–∞:
- [ ] –í—Å–µ –∞–¥–º–∏–Ω-—Ç–∞–±–ª–∏—Ü—ã (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –≤—Å–µ –±—Ä–æ–Ω–∏)
- [ ] renderTeamView - —Ç–∞–±–ª–∏—Ü–∞ –æ—Ç–¥–µ–ª–∞
- [ ] renderMyBookingsView
- [ ] –í—Å–µ –º–µ—Å—Ç–∞ –≥–¥–µ –≤—ã–≤–æ–¥–∏—Ç—Å—è `u.name`, `u.email`, `u.department`

### 3. **CSV Injection** [–°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢] üü† 
- –§—É–Ω–∫—Ü–∏—è `escapeCSV()` –¥–æ–±–∞–≤–ª–µ–Ω–∞, –Ω–æ –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ–∑–¥–µ
- –ù—É–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–∏–ø–∞ `=SYSTEM("cmd")`

### 4. **Race condition –ø—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏** [–°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢] üü†
- –ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π / –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
- –î–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–æ–≥—É—Ç –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –æ–¥–Ω–æ –º–µ—Å—Ç–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –ª–æ–∫–∏

### 5. **Realtime sync —Å–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞** [–ù–ò–ó–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢] üü°
```javascript
// –¢–ï–ö–£–©–ï–ï (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
window.addEventListener('realtimeFloor', () => location.reload());

// –ù–£–ñ–ù–û:
window.addEventListener('realtimeFloor', () => {
  renderMapView(); // –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
  renderAdminFloors();
});
```

### 6. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–æ–ª–µ–π** [–°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢] üü†
- –ú–µ–Ω–µ–¥–∂–µ—Ä –º–æ–∂–µ—Ç –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞ –∞–¥–º–∏–Ω–∞ –¥—Ä—É–≥–∏—Ö –æ—Ç–¥–µ–ª–æ–≤
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ admin-only –æ–ø–µ—Ä–∞—Ü–∏–∏

### 7. **–£—è–∑–≤–∏–º–æ—Å—Ç—å: –ü–∞—Ä–æ–ª–∏ –≤ plaintext** [–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø] üî¥
- –ü–∞—Ä–æ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ localStorage –±–µ–∑ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è  
- **–†–µ—à–µ–Ω–∏–µ**: 
  - –ù–µ —Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª–∏ –≤–æ–æ–±—â–µ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã)
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å bcrypt –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### 8. **purgeExpired() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ**
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ –∫–∞–∂–¥–æ–º render —Ñ—É–Ω–∫—Ü–∏–∏ O(n) —Ñ–∏–ª—å—Ç—Ä
- **–†–µ—à–µ–Ω–∏–µ**: –í—ã–∑—ã–≤–∞—Ç—å –æ–¥–∏–Ω —Ä–∞–∑ –≤ 5 –º–∏–Ω—É—Ç –ø–æ —Ç–∞–π–º–µ—Ä—É

### 9. **Null checks –≤ null checks**
```javascript
// –ú–µ—Å—Ç–∞ –∫–æ—Ç–æ—Ä—ã–µ –µ—â–µ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:
const sp = spaces.find(s=>s.id===b.spaceId); // —Å–ø—Ä–æ–±–µ–∂–∞?
const bk = findBookingForSpace(sp.id, ...) // sp –º–æ–∂–µ—Ç –±—ã—Ç—å undefined!
const fl = floors.find(f=>f.id===sp?.floorId); // —ç—Ç–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–ø—Ü–∏–æ–Ω–∞–ª—å —Ü–µ–ø–æ—á–∫—É –Ω–æ –¥—Ä—É–≥–∏—Ö –Ω–µ—Ç
```

### 10. **CORS –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è Supabase** [–°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢] üü†
- localhost:54321 —ç—Ç–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–µ–º–æ
- –ù—É–∂–µ–Ω real URL –ø–µ—Ä–µ–¥ production

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

| –ë–∞–≥ | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|-----|--------|-----------|
| XSS –∑–∞—â–∏—Ç–∞ | 50% ‚úÖ‚ö†Ô∏è | üî¥ –í—ã—Å–æ–∫ |
| Async/await | 0% ‚ùå | üî¥ –í—ã—Å–æ–∫–∏–π |
| localStorage –æ—à–∏–±–∫–∏ | 100% ‚úÖ | üü† –°—Ä–µ–¥–Ω–∏–π |
| Null checks | 30% ‚ö†Ô∏è | üü† –°—Ä–µ–¥–Ω–∏–π |
| CSV Injection | 50% ‚ö†Ô∏è | üü† –°—Ä–µ–¥–Ω–∏–π |
| Race condition | 0% ‚ùå | üü† –°—Ä–µ–¥–Ω–∏–π |
| Realtime sync | 0% ‚ùå | üü° –ù–∏–∑–∫–∏–π |
| –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–æ–ª–µ–π | 20% ‚ö†Ô∏è | üü† –°—Ä–µ–¥–Ω–∏–π |
| –ü–∞—Ä–æ–ª–∏ plaintext | 0% ‚ùå | üî¥ –ö–†–ò–¢–ò–ß |

---

## üöÄ –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨ –î–ê–õ–¨–®–ï

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (URGENT - Production Stopper)
```
1. [ ] –ü–æ–ª–Ω–∞—è XSS –∑–∞—â–∏—Ç–∞ –≤–µ–∑–¥–µ (escapeHtml –¥–ª—è –≤—Å–µ—Ö user data)
2. [ ] –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å async/await (–≤—ã–±—Ä–∞—Ç—å sync –ò–õ–ò async –ø–æ–ª–Ω–æ—Å—Ç—å—é)
3. [ ] –†–µ–∞–ª—å–Ω–∞—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–∏ –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å –∏—Ö —Ö—Ä–∞–Ω–µ–Ω–∏–µ
4. [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (Important)
```
5. [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ null checks (guard clauses –≤–µ–∑–¥–µ)
6. [ ] –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å escapeCSV()
7. [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å purgeExpired()
8. [ ] –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–æ–ª–µ–π
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (Nice-to-have)
```
9. [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å realtime sync
10. [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CORS –¥–ª—è production
11. [ ] –î–æ–±–∞–≤–∏—Ç—å session expiration check
12. [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
```

---

## üîó –§–∞–π–ª—ã –∫–æ—Å–Ω—É—Ç—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏

- **app.js** - –æ—Å–Ω–æ–≤–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **config.js** - ‚ö†Ô∏è —Ç—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Supabase URL
- **supabase-data-adapter.js** - —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ async/await
- **index.html** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **style.css** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ** –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–Ω—É—é XSS –∑–∞—â–∏—Ç—É —á–µ—Ä–µ–∑ npm –ø–∞–∫–µ—Ç DOMPurify
2. **–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –Ω–∞ backend** - –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å –ª–∞–≥–∏–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ –∫–ª–∏–µ–Ω—Ç–µ
3. **JWT —Ç–æ–∫–µ–Ω—ã** –≤–º–µ—Å—Ç–æ plaintext –ø–∞—Ä–æ–ª–∏
4. **Database —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
5. **Rate limiting** –Ω–∞ API
6. **Audit –ª–æ–≥–∏** –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 26.02.2026 16:30  
**–ê–≤—Ç–æ—Ä**: Code Audit
